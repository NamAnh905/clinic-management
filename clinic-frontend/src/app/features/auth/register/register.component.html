<p-toast></p-toast>

<div class="medical-background">
  <div class="floating-shape shape-1"></div>
  <div class="floating-shape shape-2"></div>
</div>

<div class="login-container">
  <div class="wellness-card wide-card">
    <div class="organic-border"></div>

    <div class="mindful-header">
      <div class="zen-logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="8.5" cy="7" r="4"></circle>
            <line x1="20" y1="8" x2="20" y2="14"></line>
            <line x1="23" y1="11" x2="17" y2="11"></line>
        </svg>
      </div>
      <h1>Tạo Tài Khoản Mới</h1>
      <p>Điền thông tin cá nhân của bạn</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

      <div class="organic-field" [class.error]="isFieldInvalid('fullName')">
        <input type="text" id="fullName" formControlName="fullName" placeholder=" " autocomplete="name">
        <label for="fullName">Họ và tên</label>
        <span class="gentle-error" *ngIf="isFieldInvalid('fullName')">Vui lòng nhập họ tên đầy đủ.</span>
      </div>

      <div class="organic-field" [class.error]="isFieldInvalid('email')">
        <input type="text" id="email" formControlName="email" placeholder=" " autocomplete="email">
        <label for="email">Email</label>
        <span class="gentle-error" *ngIf="isFieldInvalid('email')">Email không hợp lệ.</span>
      </div>

      <div class="organic-field" [class.error]="isFieldInvalid('phoneNumber')">
        <input type="text" id="phoneNumber" formControlName="phoneNumber" placeholder=" ">
        <label for="phoneNumber">Số điện thoại</label>
        <span class="gentle-error" *ngIf="isFieldInvalid('phoneNumber')">SĐT không đúng định dạng VN.</span>
      </div>

      <div class="formgrid grid">
        <div class="field col-6">
          <div class="organic-field" [class.error]="isFieldInvalid('dateOfBirth')">
             <p-calendar
                formControlName="dateOfBirth"
                [showIcon]="true"
                placeholder="Ngày sinh"
                dateFormat="dd/mm/yy"
                appendTo="body"
                styleClass="w-full custom-calendar">
            </p-calendar>

            <label class="always-top">Ngày sinh</label>
          </div>
        </div>

        <div class="field col-6">
          <div class="organic-field" [class.error]="isFieldInvalid('gender')">
            <p-dropdown
                [options]="genderOptions"
                formControlName="gender"
                placeholder="Giới tính"
                optionLabel="label"
                optionValue="value"
                appendTo="body"
                styleClass="w-full custom-dropdown">
            </p-dropdown>

            <label class="always-top">Giới tính</label>
          </div>
        </div>
      </div>

      <div class="organic-field">
        <input type="text" id="address" formControlName="address" placeholder=" ">
        <label for="address">Địa chỉ liên hệ</label>
      </div>

      <div class="organic-field" [class.error]="isFieldInvalid('password')">
        <input [type]="showPassword ? 'text' : 'password'" id="password" formControlName="password" placeholder=" ">
        <label for="password">Mật khẩu</label>
        <button type="button" class="nature-toggle" (click)="toggleVisibility('password')">
          <i class="pi" [ngClass]="showPassword ? 'pi-eye-slash' : 'pi-eye'"></i>
        </button>
        <span class="gentle-error" *ngIf="isFieldInvalid('password')">Tối thiểu 6 ký tự.</span>
      </div>

      <div class="organic-field" [class.error]="isFieldInvalid('confirmPassword') || (registerForm.errors?.['mismatch'] && registerForm.get('confirmPassword')?.touched)">
        <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword" formControlName="confirmPassword" placeholder=" ">
        <label for="confirmPassword">Nhập lại mật khẩu</label>
        <button type="button" class="nature-toggle" (click)="toggleVisibility('confirm')">
          <i class="pi" [ngClass]="showConfirmPassword ? 'pi-eye-slash' : 'pi-eye'"></i>
        </button>
        <span class="gentle-error" *ngIf="registerForm.errors?.['mismatch']">Mật khẩu không khớp.</span>
      </div>

      <button type="submit" class="harmony-button" [disabled]="registerForm.invalid || isLoading" [class.loading]="isLoading">
        <span class="button-text" *ngIf="!isLoading">Đăng Ký</span>
        <div class="button-growth" *ngIf="isLoading">
            <div class="growing-circle circle-1"></div>
            <div class="growing-circle circle-2"></div>
            <div class="growing-circle circle-3"></div>
        </div>
      </button>
    </form>

    <div class="nurture-signup mt-4">
      <span>Đã có tài khoản? </span>
      <a routerLink="/login" class="growth-link">Đăng nhập</a>
    </div>
  </div>
</div>
